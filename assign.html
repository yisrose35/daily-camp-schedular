<!DOCTYPE html>
<html>
<head>
  <title>Assign Fields</title>
  <script>
    window.onload = function(){
      let bunks = JSON.parse(localStorage.getItem("bunks") || "[]");
      let fields = JSON.parse(localStorage.getItem("fields") || "[]");
      let times = JSON.parse(localStorage.getItem("times") || "[]");

      // Normalize field names
      fields = fields.map(f => typeof f === "string" ? f : f.name);

      if(bunks.length === 0 || fields.length === 0 || times.length === 0){
        alert("Missing bunks, fields, or times. Go back to setup.");
        window.location.href = "index.html";
        return;
      }

      let assignments = {}; // {time: {bunk: field}}
      times.forEach(time => {
        const shuffled = [...fields].sort(() => Math.random() - 0.5);
        assignments[time] = {};
        bunks.forEach((bunk, i) => {
          assignments[time][bunk] = shuffled[i];
        });
      });

      // Save assignments
      localStorage.setItem("assignments", JSON.stringify(assignments));

      // Redirect back
      window.location.href = "index.html";
    }
  </script>
</head>
<body>
  <h3>Assigning fields to bunks...</h3>
</body>
</html>

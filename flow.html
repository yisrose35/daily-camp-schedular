<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Campistry Flow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="Campistry_logo.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=Fraunces:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="design-system.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="mobile-responsive.css" />
    
    <!-- FIX: Hide app container initially to prevent flash -->
    <style>
        #main-app-container {
            display: none;
        }
        #auth-loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f0f9fb 0%, #e6f7fa 50%, #edf8fa 100%);
            font-family: 'DM Sans', sans-serif;
        }
        .auth-loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e5e7eb;
            border-top-color: #1AACCA;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .auth-loading-text {
            margin-top: 16px;
            color: #374151;
            font-size: 1rem;
            font-weight: 500;
        }
        .auth-loading-subtext {
            margin-top: 4px;
            color: #6b7280;
            font-size: 0.85rem;
        }
        
        /* =============================================================== */
        /* MULTI-SCHEDULER UI STYLES */
        /* =============================================================== */
        .subdivision-status-panel {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .subdivision-status-panel h3 {
            margin: 0 0 12px 0;
            font-size: 1rem;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .subdivision-status-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .subdivision-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .subdivision-status-item.locked {
            background: #fef3c7;
            border-color: #fcd34d;
        }
        .subdivision-status-item.locked-by-others {
            background: #fee2e2;
            border-color: #fca5a5;
        }
        .subdivision-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .subdivision-name {
            font-weight: 600;
            color: #1e293b;
        }
        .subdivision-divisions {
            font-size: 0.8rem;
            color: #64748b;
        }
        .subdivision-lock-info {
            font-size: 0.75rem;
            color: #92400e;
            margin-top: 2px;
        }
        .lock-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.15s;
        }
        .lock-btn.can-lock {
            background: #147D91;
            color: white;
        }
        .lock-btn.can-lock:hover {
            background: #0F5F6E;
        }
        .lock-btn.can-unlock {
            background: #f59e0b;
            color: white;
        }
        .lock-btn.can-unlock:hover {
            background: #d97706;
        }
        .lock-btn.locked-other {
            background: #e5e7eb;
            color: #6b7280;
            cursor: not-allowed;
        }
        .lock-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Locked bunk indicator in schedule grid */
        .bunk-row.locked-by-other {
            opacity: 0.7;
            position: relative;
        }
        .bunk-row.locked-by-other::after {
            content: '\1F512';
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
        }
        .bunk-row.locked-by-other .cell {
            pointer-events: none;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 5px,
                rgba(0,0,0,0.03) 5px,
                rgba(0,0,0,0.03) 10px
            );
        }
    </style>
</head>
<body>

<!-- =============================================================== -->
<!-- AUTH LOADING SCREEN (Shown while checking session) -->
<!-- =============================================================== -->
<div id="auth-loading-screen">
    <div class="auth-loading-spinner"></div>
    <div class="auth-loading-text">Loading Campistry Flow</div>
    <div class="auth-loading-subtext">Checking authentication...</div>
</div>

<!-- =============================================================== -->
<!-- MAIN APP WRAPPER (Hidden until authenticated) -->
<!-- =============================================================== -->
<div id="main-app-container">
    <div class="app-shell">
        <!-- =========================================================== -->
        <!-- HEADER -->
        <!-- =========================================================== -->
        <header class="app-header">
            <div class="header-left">
                <!-- DASHBOARD LINK -->
                <a href="dashboard.html" style="color:#147D91; text-decoration:none; font-weight:500; margin-right:16px;">&larr; Dashboard</a>

                <!-- Hamburger -->
                <button id="hamburgerBtn" class="hamburger-btn" aria-label="Toggle Navigation">
                    <span></span><span></span><span></span>
                </button>
                <!-- App Title: Flow Branding -->
                <div class="app-title">
                    <img src="Flow_clean.png" alt="Campistry Flow" class="app-logo-full app-logo-flow-img">
                </div>

                <!-- Quick Link: Campistry Me -->
                <a href="campistry_me.html" class="header-app-switch" title="Open Campistry Me â€” Structure &amp; Campers">
                    <img src="Me_clean.png" alt="Campistry Me" class="app-logo-full app-logo-me-img">
                </a>
            </div>
            <div class="header-right">
                <label class="header-date-label" for="calendar-date-picker">
                    Current Schedule Date:
                </label>
                <input type="date" id="calendar-date-picker" class="header-date-input" aria-label="Schedule date" />
            </div>
        </header>

        <!-- =========================================================== -->
        <!-- APP MAIN LAYOUT -->
        <!-- =========================================================== -->
        <div class="app-main">
            <!-- ======================================================= -->
            <!-- SIDEBAR NAVIGATION -->
            <!-- ======================================================= -->
            <aside id="sidebar" class="sidebar">
                <nav class="sidebar-nav">
                    <div class="sidebar-label">Configuration</div>
                    <button class="sidebar-item active" data-tab="setup">
                        <span class="sidebar-dot"></span> Setup (Bunks / Divisions)
                    </button>
                    <button class="sidebar-item" data-tab="locations">
                        <span class="sidebar-dot"></span> Location Zones
                    </button>
                    <button class="sidebar-item" data-tab="fields">
                        <span class="sidebar-dot"></span> Fields
                    </button>
                    <button class="sidebar-item" data-tab="special_activities">
                        <span class="sidebar-dot"></span> Special Activities
                    </button>
                    <button class="sidebar-item" data-tab="leagues">
                        <span class="sidebar-dot"></span> Leagues
                    </button>
                    <button class="sidebar-item" data-tab="specialty-leagues">
                        <span class="sidebar-dot"></span> Specialty Leagues
                    </button>

                    <div class="sidebar-label" style="margin-top:12px;">Scheduling</div>
                    <button class="sidebar-item" data-tab="master-scheduler">
                        <span class="sidebar-dot"></span> Master Scheduler
                    </button>
                    <button class="sidebar-item" data-tab="daily-adjustments">
                        <span class="sidebar-dot"></span> Daily Adjustments
                    </button>
                    <button class="sidebar-item" data-tab="schedule">
                        <span class="sidebar-dot"></span> Daily Schedule (View)
                    </button>

                    <!-- â˜… FIX: Removed duplicate Updates and Help & Guide entries -->
                    <div class="sidebar-label" style="margin-top:12px;">Output &amp; Help</div>
                    <button class="sidebar-item" data-tab="print">
                        <span class="sidebar-dot"></span> Print Center
                    </button>
                    <button class="sidebar-item" data-tab="camper-locator">
                        <span class="sidebar-dot"></span> Camper Locator
                    </button>
                    <button class="sidebar-item" data-tab="report">
                        <span class="sidebar-dot"></span> Report
                    </button>
                    <button class="sidebar-item" data-tab="updates">
                        <span class="sidebar-dot"></span> Updates
                    </button>
                    <button class="sidebar-item" data-tab="helper">
                        <span class="sidebar-dot"></span> Help &amp; Guide
                    </button>
                </nav>
            </aside>

            <!-- BACKDROP (Mobile) -->
            <div id="sidebarBackdrop" class="sidebar-backdrop"></div>

            <!-- ======================================================= -->
            <!-- MAIN CONTENT -->
            <!-- ======================================================= -->
            <main class="app-content">

                <!-- =================================================== -->
                <!-- SETUP TAB -->
                <!-- =================================================== -->
                <div id="setup" class="tab-content active">
                    <div class="setup-grid">

                        <!-- Left Panel: Grades -->
                        <section class="setup-card">
                            <div class="setup-card-header">
                                <div class="setup-step-pill">Grades</div>
                                <div class="setup-card-text">
                                    <h3>Scheduling Grades</h3>
                                    <p>Select a grade to configure its times.</p>
                                </div>
                            </div>
                            <div id="divisionButtons" class="master-list"></div>
                        </section>

                        <!-- Right Panel: Grade Configuration -->
                        <section class="setup-card">
                            <div class="setup-card-header">
                                <div class="setup-step-pill">Times</div>
                                <div class="setup-card-text">
                                    <h3>Grade Configuration</h3>
                                    <p>Set scheduling times for the selected grade.</p>
                                </div>
                            </div>
                            <div id="division-detail-pane" class="detail-pane">
                                <p class="muted">
                                    Select a grade to configure its times and view its bunks.
                                </p>
                            </div>
                        </section>

                        <!-- Tools & Maintenance -->
                        <section class="setup-card setup-card-wide">
                            <div class="setup-card-header">
                                <div class="setup-step-pill setup-step-pill-muted">Tools</div>
                                <div class="setup-card-text">
                                    <h3>Data &amp; Maintenance</h3>
                                    <p>Manage schedules, history &amp; backups.</p>
                                </div>
                            </div>

                            <!-- Clear History -->
                            <div class="setup-group">
                                <h4>Clear Schedules &amp; History</h4>
                                <p class="setup-group-help">
                                    Erase generated data without touching setup.
                                </p>
                                <div class="setup-button-row">
                                    <button id="eraseTodayBtn"
                                            style="background:#db7a00;color:#fff;border:none;"
                                            onclick="if(confirm('Delete today\'s schedule?')) window.eraseCurrentDailyData?.();">
                                        Delete ONLY Today's Schedule
                                    </button>
                                    <button id="eraseAllSchedulesBtn"
                                            style="background:#c0392b;color:#fff;border:none;"
                                            onclick="if(confirm('Delete ALL schedules for ALL days?')) window.eraseAllDailyData?.();">
                                        Delete ALL Daily Schedules
                                    </button>
                                    <button id="eraseHistoryBtn"
                                            style="background:#5e35b1;color:#fff;border:none;"
                                            onclick="
                                                if(confirm('Reset rotation history and League counters?')) {
                                                    window.eraseRotationHistory?.();
                                                    window.leagueRoundState = {};
                                                    window.saveGlobalSettings?.('leagueRoundState', {});
                                                    alert('Activity History and Game Counters reset!');
                                                }
                                            ">
                                        Reset Activity History
                                    </button>
                                    <button id="newHalfBtn"
                                            style="background:#0d9488;color:#fff;border:none;"
                                            onclick="window.startNewHalf?.();">
                                        New Half
                                    </button>
                                </div>
                            </div>

                            <!-- Backup -->
                            <div class="setup-group">
                                <h4>Backup &amp; Restore</h4>
                                <p class="setup-group-help">Download or upload full application data.</p>
                                <div class="setup-button-row">
                                    <button id="exportBackupBtn"
                                            style="background:#147D91;color:#fff;border:none;">
                                        Export Data to File
                                    </button>
                                    <button id="importBackupBtn"
                                            style="background:#1AACCA;color:#fff;border:none;">
                                        Import Data
                                    </button>
                                    <input type="file" id="importFileInput" accept=".json" style="display:none;" />
                                    <button id="restoreAutoSaveBtn"
                                            style="background:#6c757d;color:#fff;border:none;"
                                            onclick="window.restoreAutoSave?.()">
                                        Restore Last Auto-Save
                                    </button>
                                    <button id="forceSaveBtn"
                                            style="background:#0F5F6E;color:#fff;border:none;"
                                            onclick="window.forceAutoSave?.()">
                                        Save Now
                                    </button>
                                </div>
                            </div>

                            <!-- Full Wipe -->
                            <div class="setup-group setup-group-danger">
                                <h4>Erase All Data</h4>
                                <p class="setup-group-help">This resets EVERYTHING &ndash; setup + schedules.</p>
                                <div class="setup-button-row">
                                    <button id="eraseAllBtn"
                                            style="background:#c0392b;color:#fff;border:none;">
                                        Erase All Camp Data
                                    </button>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <!-- /setup -->

                <!-- ======================================================= -->
                <!-- OTHER TABS -->
                <!-- ======================================================= -->
                <div id="locations" class="tab-content"></div>
                <div id="fields" class="tab-content"></div>
                <div id="special_activities" class="tab-content"></div>
                <div id="leagues" class="tab-content"></div>
                <div id="specialty-leagues" class="tab-content"></div>

                <div id="master-scheduler" class="tab-content">
                    <!-- MULTI-SCHEDULER: Subdivision Status Panel will be inserted here -->
                    <div id="subdivision-status-container"></div>
                    <div id="master-scheduler-content"></div>
                </div>

               <div id="daily-adjustments" class="tab-content">
    <div id="daily-adjustments-content"></div>
</div>

                <div id="schedule" class="tab-content">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        <h3>Daily Schedule (View)</h3>
                        <button onclick="window.validateSchedule?.()"
                            style="background:#ff9800;color:white;border:none;padding:8px 16px;border-radius:4px;font-weight:bold;">
                            Validate Schedule
                        </button>
                    </div>
                    <div id="scheduleTable"></div>
                </div>

                <div id="camper-locator" class="tab-content"></div>
                <div id="report" class="tab-content"><div id="report-content"></div></div>
                <div id="print" class="tab-content"><div id="print-content"></div></div>
                <div id="updates" class="tab-content"><div id="updates-content"></div></div>
                <div id="helper" class="tab-content"><div id="helper-content"></div></div>
            </main>
            <!-- /app-content -->
        </div>
        <!-- /app-main -->
    </div>
    <!-- /app-shell -->
</div>
<!-- /main-app-container -->

<!-- =============================================================== -->
<!-- SCRIPT LOADING (ORDER MATTERS) -->
<!-- =============================================================== -->

<!-- CLOUD FOUNDATION (MUST LOAD FIRST) -->
    <script src="offline_data.js" onerror=""></script>
<script src="demo_mode.js"></script>
<script>
// â˜… v7.1: Non-blocking Supabase loader (fixes Chrome document.write warning)
(function() {
    var src = window.location.protocol === 'file:'
        ? 'supabase-js-local.js'
        : 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
    var s = document.createElement('script');
    s.src = src;
    s.onload = function() {
        // Load supabase_client.js after Supabase SDK is ready
        var c = document.createElement('script');
        c.src = 'supabase_client.js';
        document.head.appendChild(c);
    };
    s.onerror = function() {
        console.error('Failed to load Supabase SDK from:', src);
    };
    document.head.appendChild(s);
})();
</script>
    <script src="campistry_security.js"></script>
<script src="supabase_permissions.js"></script>
<script src="supabase_schedules.js"></script>
<script src="supabase_sync.js"></script>
<script src="integration_hooks.js"></script>

<script src="schedule_versions_db.js"></script>
<script src="global_authority.js"></script>
<script src="cloud_sync_helpers.js"></script>

<!-- AUTH CHECK - Must run before app loads -->
<script>
(function() {
    'use strict';
    
    // Flag so welcome.js knows inline auth is handling boot
    window.__CAMPISTRY_AUTH_INLINE__ = true;
    
    const loadingScreen = document.getElementById('auth-loading-screen');
    const mainApp = document.getElementById('main-app-container');
    
   async function checkAuthAndBoot() {
    try {
        // â˜… FAST-PASS: If localStorage has auth tokens from a successful login,
        // trust them and proceed â€” don't bounce back to landing page.
        // Supabase session will be verified in the background.
        const cachedUserId = localStorage.getItem('campistry_auth_user_id');
        const cachedCampId = localStorage.getItem('campistry_camp_id');
        const hasLocalAuth = !!(cachedUserId && cachedCampId);
        
        if (hasLocalAuth) {
            console.log('ðŸ”‘ [Auth] Fast-pass: cached auth found, proceeding with boot');
        }
        
        let attempts = 0;
        while (!window.supabase && attempts < 20) {
            await new Promise(r => setTimeout(r, 100));
            attempts++;
        }
        
        if (!window.supabase) {
            if (hasLocalAuth) {
                console.warn('ðŸ”‘ [Auth] Supabase SDK not loaded, but cached auth exists â€” proceeding');
                // Still show the app; supabase will init eventually
                showApp();
                return;
            }
            redirectToLogin(); return;
        }
        
        const { data: { session }, error } = await window.supabase.auth.getSession();
        
        if (error || !session) {
            if (hasLocalAuth) {
                console.warn('ðŸ”‘ [Auth] No Supabase session yet, but cached auth exists â€” proceeding');
                // Try to refresh the session in the background
                window.supabase.auth.refreshSession().then(({ data, error }) => {
                    if (error || !data?.session) {
                        console.warn('ðŸ”‘ [Auth] Background session refresh failed â€” clearing cache and redirecting');
                        localStorage.removeItem('campistry_auth_user_id');
                        localStorage.removeItem('campistry_camp_id');
                        localStorage.removeItem('campistry_role');
                        redirectToLogin();
                    } else {
                        console.log('ðŸ”‘ [Auth] Background session refresh succeeded');
                    }
                });
                // Don't wait â€” proceed to show app
                await waitForCloudHydration();
                showApp();
                return;
            }
            redirectToLogin(); return;
        }
            // Listen for sign-out after client is confirmed ready
            window.supabase.auth.onAuthStateChange((event) => {
                if (event === 'SIGNED_OUT') redirectToLogin();
            });
            if (loadingScreen) {
                const subtext = loadingScreen.querySelector('.auth-loading-subtext');
                if (subtext) subtext.textContent = 'Loading your camp data...';
            }
            
            await waitForCloudHydration();
            showApp();
            
        } catch (e) {
            console.error("Auth check failed:", e);
            redirectToLogin();
        }
    }
    
    function redirectToLogin() {
        window.location.href = 'index.html';
    }
    
    async function waitForCloudHydration() {
        return new Promise((resolve) => {
            if (window.__CAMPISTRY_CLOUD_READY__) { resolve(); return; }
            
            const handler = () => {
                window.removeEventListener('campistry-cloud-hydrated', handler);
                clearTimeout(timeout);
                resolve();
            };
            
            window.addEventListener('campistry-cloud-hydrated', handler);
            
            const timeout = setTimeout(() => {
                window.removeEventListener('campistry-cloud-hydrated', handler);
                resolve();
            }, 5000);
        });
    }
    
    function showApp() {
        if (loadingScreen) loadingScreen.style.display = 'none';
        if (mainApp) mainApp.style.display = 'block';
        
        window.__CAMPISTRY_BOOTED__ = true;
        
        window.refreshGlobalRegistry?.();
        window.initCalendar?.();
        window.initApp1?.();
        window.initLeagues?.();
        window.initScheduleSystem?.();
        window.initDailyAdjustments?.();
    }
    
   if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkAuthAndBoot);
    } else {
        setTimeout(checkAuthAndBoot, 100);
    }
})();
</script>

<!-- CORE APP -->
<script src="welcome.js"></script>
<script src="calendar.js"></script>
<script src="app1.js"></script>
<script src="locations.js"></script>
<script src="skeleton_sandbox.js"></script>
<script src="daily_adjustments.js"></script>
<script src="rainy_day_manager.js"></script>
<script src="midday_rain_stacker.js"></script>
<script src="special_activities.js"></script>
<script src="fields.js"></script>
<script src="leagues.js"></script>
<script src="specialty_leagues.js"></script>
<script src="master_schedule_builder.js"></script>
<script src="smart_logic_adapter.js"></script>

<!-- PERMISSIONS & VERSIONING SYSTEM -->
<script src="permissions_guard.js"></script>

<!-- RBAC & MULTI-SCHEDULER SYSTEM (LOAD BEFORE SCHEDULER CORE) -->
<script src="access_control.js"></script>
<script src="subdivision_schedule_manager.js"></script>
<script src="rbac_init.js"></script>

<script src="division_times_system.js"></script>
<script src="division_times_integration.js"></script>
<script src="trial_guard.js"></script>
<!-- SCHEDULER CORE -->
<script src="scheduler_core_loader.js"></script>
<script src="global_field_locks.js"></script>
<script src="scheduler_core_utils.js"></script>
<script src="rotation_engine.js"></script>
<script src="total_solver_engine.js"></script>
<script src="scheduler_core_specialty_leagues.js"></script>
<script src="scheduler_core_leagues.js"></script>
<script src="scheduler_logic_fillers.js"></script>
<script src="scheduler_core_main.js"></script>
<script src="schedule_orchestrator.js"></script>

<!-- UNIFIED SCHEDULE SYSTEM -->
<script src="unified_schedule_system.js"></script>
<script src="post_edit_system.js"></script>

<!-- Pinned preservation (must come after scheduler_core_main.js) -->
<script src="pinned_activity_preservation.js"></script>

<!-- OUTPUT / HELP -->
<script src="analytics.js"></script>
<script src="camper_locator.js"></script>
<script src="validator.js"></script>
<script src="print_center.js"></script>
<script src="helper.js"></script>
<script src="updates.js"></script>
    <script src="rbac_diagnostics.js"></script>
<script src="campistry_diagnostics.js"></script>
<script src="mobile_touch_drag.js"></script>
<!-- TAB NAVIGATION & SIDEBAR HANDLING -->
<script>
/* TAB SWITCHING */
function showTab(id) {
    document.querySelectorAll(".tab-content").forEach(el =>
        el.classList.remove("active")
    );
    document.getElementById(id)?.classList.add("active");
    document.querySelectorAll(".sidebar-item").forEach(btn =>
        btn.classList.toggle("active", btn.dataset.tab === id)
    );

    if (id === "setup") window.initApp1?.();
    if (id === "locations") window.initLocationsTab?.();
    if (id === "fields") window.initFieldsTab?.();
    if (id === "special_activities") window.initSpecialActivitiesTab?.();
    if (id === "leagues") window.initLeagues?.();
    if (id === "specialty-leagues") window.initSpecialtyLeagues?.();
    if (id === "master-scheduler") {
        window.initMasterScheduler?.();
        const container = document.getElementById('subdivision-status-container');
        if (container) {
            window.SchedulerSubdivisionIntegration?.createSubdivisionStatusPanel?.(container);
        }
    }
    if (id === "daily-adjustments") window.initDailyAdjustments?.();
    if (id === "schedule") window.updateTable?.();
    if (id === "camper-locator") window.initCamperLocator?.();
    if (id === "report") window.initReportTab?.();
    if (id === "print") window.initPrintCenter?.();
    if (id === "updates") window.initUpdatesTab?.();
    if (id === "helper") window.initHelperTab?.();
}

/* SIDEBAR (Mobile) â€” with scroll-lock to prevent content scrolling behind */
(function () {
    const hamburger = document.getElementById("hamburgerBtn");
    const sidebar = document.getElementById("sidebar");
    const backdrop = document.getElementById("sidebarBackdrop");
    let savedScrollY = 0;

    function openSidebar() {
        savedScrollY = window.scrollY;
        document.body.style.top = -savedScrollY + 'px';
        document.body.classList.add("sidebar-open");
    }
    function closeSidebar() {
        document.body.classList.remove("sidebar-open");
        document.body.style.top = '';
        window.scrollTo(0, savedScrollY);
    }

    hamburger?.addEventListener("click", () => {
        if (document.body.classList.contains("sidebar-open")) {
            closeSidebar();
        } else {
            openSidebar();
        }
    });
    backdrop?.addEventListener("click", () => closeSidebar());

    sidebar?.querySelectorAll(".sidebar-item").forEach(btn => {
        btn.addEventListener("click", () => {
            showTab(btn.dataset.tab);
            closeSidebar();
        });
    });
})();
</script>
</body>
</html>

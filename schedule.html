<!DOCTYPE html>
<html>
<head>
  <title>Camp Scheduler - Daily Schedule</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { margin-bottom: 20px; }
    .tab-button { padding: 10px 20px; border: 1px solid #ccc; background: #f0f0f0; margin-right: 5px; text-decoration: none; color: black; }
    .tab-button.active { background: #007BFF; color: white; font-weight: bold; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: center; min-width: 100px; }
    th { background: #f0f0f0; }
    td.schedule-cell { cursor: pointer; }
    td.schedule-cell:hover { background: #f9f9f9; }
    select { padding: 3px; margin: 2px; }
  </style>
</head>
<body>
  <h1>Camp Scheduler</h1>

  <!-- Navigation Tabs -->
  <div class="tabs">
    <a href="index.html" class="tab-button">Setup & Configuration</a>
    <a href="schedule.html" class="tab-button active">Daily Schedule</a>
  </div>

  <p>This page loads your saved setup from <b>Setup & Config</b>.  
  If nothing shows, go back and save first.</p>

  <table id="scheduleTable" style="display:none;">
    <thead>
      <tr id="divisionRow"></tr>
      <tr id="bunkRow"></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let bunks = [];
    let divisions = {};
    let availableDivisions = [];
    let times = [];
    let fields = [];

    function loadSetup() {
      const saved = localStorage.getItem("campSetup");
      if (!saved) {
        alert("No setup found! Go back to Setup tab and save first.");
        return false;
      }
      const data = JSON.parse(saved);
      bunks = data.bunks || [];
      divisions = data.divisions || {};
      availableDivisions = data.availableDivisions || [];
      times = data.times || [];
      fields = data.fields || [];
      return true;
    }

    function renderSchedule() {
      if (times.length === 0 || availableDivisions.length === 0) {
        alert("No times or divisions available. Please set them up first.");
        return;
      }

      const table = document.getElementById("scheduleTable");
      table.style.display = "table";

      const divRow = document.getElementById("divisionRow");
      const bunkRow = document.getElementById("bunkRow");
      divRow.innerHTML = "<th>Time</th>";
      bunkRow.innerHTML = "<th></th>";

      availableDivisions.forEach(divName => {
        const divObj = divisions[divName];
        const bunksInDiv = divObj.bunks;

        const thDiv = document.createElement("th");
        thDiv.colSpan = bunksInDiv.length || 1;
        thDiv.style.backgroundColor = divObj.color || "#ccc";
        thDiv.style.color = "white";
        thDiv.textContent = divName;
        divRow.appendChild(thDiv);

        bunksInDiv.forEach(bunk => {
          const thBunk = document.createElement("th");
          thBunk.textContent = bunk;
          bunkRow.appendChild(thBunk);
        });
      });

      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML = "";
      times.forEach(time => {
        const row = document.createElement("tr");
        const tdTime = document.createElement("td");
        tdTime.textContent = time;
        row.appendChild(tdTime);

        availableDivisions.forEach(divName => {
          divisions[divName].bunks.forEach(() => {
            const td = document.createElement("td");
            td.className = "schedule-cell";
            td.onclick = () => assignActivity(td);
            row.appendChild(td);
          });
        });

        tbody.appendChild(row);
      });
    }

    function assignActivity(cell) {
      cell.innerHTML = "";
      const select = document.createElement("select");
      const placeholder = document.createElement("option");
      placeholder.textContent = "Select field...";
      placeholder.value = "";
      select.appendChild(placeholder);

      fields.filter(f => f.available).forEach(f => {
        const opt = document.createElement("option");
        opt.value = f.name;
        opt.textContent = f.name;
        select.appendChild(opt);
      });

      select.onchange = () => {
        const chosenField = fields.find(f => f.name === select.value);
        if (!chosenField) return;

        if (chosenField.activities.length > 0) {
          const actSelect = document.createElement("select");
          chosenField.activities.forEach(act => {
            const opt = document.createElement("option");
            opt.value = act;
            opt.textContent = act;
            actSelect.appendChild(opt);
          });
          actSelect.onchange = () => {
            cell.textContent = `${chosenField.name} (${actSelect.value})`;
          };
          cell.innerHTML = "";
          cell.appendChild(actSelect);
        } else {
          cell.textContent = chosenField.name;
        }
      };

      cell.appendChild(select);
    }

    // Init
    if (loadSetup()) {
      renderSchedule();
    }
  </script>
</body>
</html>

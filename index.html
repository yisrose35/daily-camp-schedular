<!DOCTYPE html>
<html>
<head>
  <title>Camp Scheduler</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { margin-bottom: 20px; }
    .tab-button { padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; background: #f0f0f0; margin-right: 5px; }
    .tab-button.active { background: #007BFF; color: white; font-weight: bold; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid black; padding: 8px; text-align: center; min-width: 80px; }
    th.editable:hover, td.editable:hover { background-color: #f0f0f0; cursor: text; }

    .bunk-button { margin: 2px; padding: 5px 10px; cursor: pointer; border: 1px solid #333; border-radius: 4px; display: inline-block; }
    .selected { outline: 3px solid #90CAF9; }
    #unassignedBunks { margin-top: 10px; }
    .divisionWrapper { display: inline-block; margin-right: 10px; }
    .colorPicker { width: 30px; height: 30px; border: none; cursor: pointer; vertical-align: middle; }

    .fieldWrapper { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 6px; }
    .fieldWrapper h4 { margin: 0 0 5px 0; display: inline-block; margin-right: 10px; }
    .fieldWrapper.unavailable { opacity: 0.5; }
    .activity-button { margin: 2px; padding: 4px 8px; border: 1px solid #333; border-radius: 3px; cursor: pointer; }
    .activity-button.active { background: #007BFF; color: white; }

    /* Toggle switch */
    .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc; transition: .4s; border-radius: 20px; }
    .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px;
      background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #4CAF50; }
    input:checked + .slider:before { transform: translateX(20px); }

    input.time-input {
      width: 90px;
      text-align: center;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>Camp Scheduler</h1>

  <div class="tabs">
    <button class="tab-button active" onclick="showTab('setup')">Setup & Configuration</button>
    <button class="tab-button" onclick="showTab('schedule')">Daily Schedule</button>
  </div>

  <!-- Setup Tab -->
  <div id="setup" class="tab-content active">
    <!-- Bunk Input -->
    <h3>Add Bunks</h3>
    <input id="bunkInput" placeholder="Enter bunk">
    <button onclick="addBunk()">Add Bunk</button>

    <!-- Division Input -->
    <h3>Add Divisions</h3>
    <input id="divisionInput" placeholder="Enter division name">
    <button onclick="addDivision()">Add Division</button>
    <label><input type="checkbox" id="enableColor" checked> Enable colors</label>
    <div id="divisionButtons"></div>

    <!-- Time Inputs -->
    <h3>Generate Times</h3>
    Start: <input type="text" id="startTime" class="time-input" value="__:__">
    End: <input type="text" id="endTime" class="time-input" value="__:__">
    Increment:
    <select id="increment">
      <option value="15">15 min</option>
      <option value="30">30 min</option>
      <option value="45">45 min</option>
      <option value="60">60 min</option>
    </select>
    <button onclick="generateTimes()">Generate</button>

    <!-- Unassigned Bunks -->
    <h4>Unassigned Bunks</h4>
    <div id="unassignedBunks"></div>

    <!-- Field Input -->
    <h3>Add Fields/Courts</h3>
    <input id="fieldInput" placeholder="Enter field/court name (e.g., Court #1)">
    <button onclick="addField()">Add Field/Court</button>
    <div id="fieldList"></div>
  </div>

  <!-- Schedule Tab -->
  <div id="schedule" class="tab-content">
    <table id="scheduleTable" style="display:none;">
      <thead>
        <tr id="divisionRow"></tr>
        <tr id="bunkRow"></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // ============================== TAB FUNCTIONALITY
    function showTab(id){
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelector(`.tab-button[onclick="showTab('${id}')"]`).classList.add('active');
      if(id==='schedule') updateTable();
    }

    // ============================== DATA
    let bunks = [];
    let times = [];
    let divisions = {};
    let availableDivisions = [];
    let selectedDivision = null;
    const defaultColors = ['#4CAF50','#2196F3','#E91E63','#FF9800','#9C27B0','#00BCD4','#FFC107','#F44336'];
    let colorIndex = 0;
    let fields = [];
    const commonActivities = ["Basketball","Football","Baseball","Hockey","Volleyball","Soccer","Lacrosse"];

    // ============================== TIME INPUT MASK
    function setupTimeInput(input, nextField = null, isEnd = false) {
      input.addEventListener("input", function () {
        let val = this.value.replace(/[^0-9APMapm]/g, "");

        // Always keep colon after 2 digits
        if (val.length <= 2) {
          if (val.length === 2) val = val + ":";
        } else {
          val = val.slice(0, 2) + ":" + val.slice(2);
        }

        this.value = val.toUpperCase();
      });

      input.addEventListener("keyup", function (e) {
        if (e.key === "Enter") {
          if (isEnd) {
            generateTimes();
          } else if (nextField) {
            nextField.focus();
          }
        }
        if (!isEnd && this.value.match(/(AM|PM)$/i) && nextField) {
          nextField.focus();
        }
      });
    }

    setupTimeInput(document.getElementById("startTime"), document.getElementById("endTime"), false);
    setupTimeInput(document.getElementById("endTime"), null, true);

    // ============================== GENERATE TIMES
    function generateTimes() {
      const startInput = document.getElementById("startTime").value.trim();
      const endInput = document.getElementById("endTime").value.trim();
      const increment = parseInt(document.getElementById("increment").value);

      function parseTime(str) {
        const match = str.match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i);
        if (!match) return null;

        let h = parseInt(match[1], 10);
        const m = parseInt(match[2], 10);
        const ampm = match[3].toUpperCase();

        if (ampm === "PM" && h !== 12) h += 12;
        if (ampm === "AM" && h === 12) h = 0;

        return new Date(0, 0, 0, h, m);
      }

      const startDate = parseTime(startInput);
      const endDate = parseTime(endInput);

      if (!startDate || !endDate) {
        alert("Please enter valid times in the format hh:mm AM/PM");
        return;
      }
      if (startDate >= endDate) {
        alert("Start must be before end");
        return;
      }

      times = [];
      let current = new Date(startDate.getTime());

      function format(d) {
        let h = d.getHours();
        let m = d.getMinutes().toString().padStart(2, "0");
        let ampm = h >= 12 ? "PM" : "AM";
        h = h % 12 || 12;
        return `${h}:${m} ${ampm}`;
      }

      while (current < endDate) {
        let next = new Date(current.getTime() + increment * 60000);
        if (next > endDate) next = endDate;
        times.push(`${format(current)} - ${format(next)}`);
        current = next;
      }

      updateTable();
    }

    // ============================== ENTER KEY SUPPORT
    document.getElementById("bunkInput").addEventListener("keyup", function(e){ if(e.key==="Enter") addBunk(); });
    document.getElementById("divisionInput").addEventListener("keyup", function(e){ if(e.key==="Enter") addDivision(); });
    document.getElementById("fieldInput").addEventListener("keyup", function(e){ if(e.key==="Enter") addField(); });

    // ============================== PLACEHOLDER FUNCTIONS (keep your existing addBunk, addDivision, etc.)
    function addBunk(){/* your existing logic */}
    function addDivision(){/* your existing logic */}
    function addField(){/* your existing logic */}
    function updateTable(){/* your existing logic */}
  </script>
</body>
</html>

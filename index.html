<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Camp Scheduler Pro</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Modern Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

    <!-- Welcome Overlay -->
    <div id="welcome-screen" style="display: none;">
        <div class="welcome-card">
            <img src="https://placehold.co/100x100/2563eb/ffffff?text=CS&font=roboto" alt="Logo" style="border-radius:12px; margin-bottom:24px;">
            <h1 style="margin:0 0 12px 0; color:#0f172a;">Welcome</h1>
            <p class="text-muted" style="margin-bottom:24px;">Enter your camp's name to begin setting up your schedule.</p>
            <input type="text" id="camp-name-input" placeholder="E.g., Camp Adventure" style="margin-bottom:16px; text-align:center; font-size:1.1rem;">
            <button id="begin-btn" class="btn-primary" style="width:100%; padding:12px;">Get Started</button>
        </div>
    </div>

    <!-- Main App Grid -->
    <div id="main-app-container" class="app-container" style="display: none;">
        
        <!-- Sidebar -->
        <nav id="app-sidebar">
            <div class="logo-area">
                <span>ğŸ•ï¸ Scheduler Pro</span>
            </div>
            <div class="nav-links">
                <div class="nav-category">Configuration</div>
                <button class="nav-item active" onclick="showTab('setup')">âš™ï¸ General Setup</button>
                <button class="nav-item" onclick="showTab('fields'); window.initFieldsTab?.();">ğŸ“ Fields</button>
                <button class="nav-item" onclick="showTab('special_activities'); window.initSpecialActivitiesTab?.();">ğŸ¨ Activities</button>
                
                <div class="nav-category">Scheduling</div>
                <button class="nav-item" onclick="showTab('master-scheduler'); window.initMasterScheduler?.();">ğŸ—“ï¸ Master Templates</button>
                <button class="nav-item" onclick="showTab('daily-adjustments'); window.initDailyAdjustments?.();">ğŸ”§ Daily Builder</button>
                <button class="nav-item" onclick="showTab('schedule')">ğŸ“… View Schedule</button>

                <div class="nav-category">Leagues</div>
                <button class="nav-item" onclick="showTab('leagues'); window.initLeagues?.();">ğŸ† Regular Leagues</button>
                <button class="nav-item" onclick="showTab('specialty-leagues'); window.initSpecialtyLeagues?.();">ğŸ¥‡ Specialty Leagues</button>
                
                <div class="nav-category">Tools</div>
                <button class="nav-item" onclick="showTab('report'); window.initReportTab?.();">ğŸ“Š Analytics</button>
                <button class="nav-item" onclick="showTab('print'); window.initPrintCenter?.();">ğŸ–¨ï¸ Print Center</button>
                <button class="nav-item" onclick="showTab('helper'); window.initHelperTab?.();">â“ Help Guide</button>
            </div>
        </nav>

        <!-- Header -->
        <header id="app-header">
            <div class="header-title">
                <h2 id="page-title">Setup</h2>
            </div>
            <div class="header-controls">
                <div class="date-control-wrapper">
                    <label>Schedule Date:</label>
                    <input type="date" id="calendar-date-picker">
                </div>
                <button id="forceSaveBtn" class="btn-primary">ğŸ’¾ Save All</button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="app-main">
            
            <!-- SETUP TAB (Redesigned) -->
            <div id="setup" class="tab-content active">
                <div class="grid-2">
                    <!-- Bunks Card -->
                    <div class="card">
                        <h3>ğŸ  Bunks</h3>
                        <div class="flex-row">
                            <input id="bunkInput" placeholder="Enter bunk name..." style="flex:1;">
                            <button id="addBunkBtn" class="btn-primary">Add</button>
                        </div>
                        <div id="unassignedBunks" class="chips"></div>
                    </div>

                    <!-- Divisions Card -->
                    <div class="card">
                        <h3>ğŸ“‚ Divisions</h3>
                        <div class="flex-row mb-4">
                            <input id="divisionInput" placeholder="Division name..." style="flex:1;">
                            <button id="addDivisionBtn" class="btn-primary">Add</button>
                        </div>
                        <label class="text-muted flex-row" style="margin-bottom:12px;">
                            <input type="checkbox" id="enableColor" checked> Enable Division Colors
                        </label>
                        <div id="divisionButtons" style="display:flex; flex-direction:column; gap:10px;"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ’¾ Data Management</h3>
                    <p class="text-muted mb-4">Manage your camp data, create backups, or reset the system.</p>
                    <div class="flex-row" style="flex-wrap: wrap;">
                        <button id="exportBackupBtn">Export Backup</button>
                        <button id="importBackupBtn">Import Backup</button>
                        <input type="file" id="importFileInput" accept=".json" style="display: none;">
                        <button id="restoreAutoSaveBtn">Restore Auto-Save</button>
                    </div>
                    <hr style="border-top:1px solid var(--border-color); margin:20px 0;">
                    <h4 style="color:var(--danger); margin-top:0;">Danger Zone</h4>
                    <div class="flex-row">
                        <button id="eraseTodayBtn" class="btn-danger">Clear Today</button>
                        <button id="eraseAllBtn" class="btn-danger">Factory Reset</button>
                    </div>
                </div>
            </div> 
            
            <!-- Placeholders for other modules -->
            <div id="fields" class="tab-content"></div>
            <div id="special_activities" class="tab-content"></div>
            <div id="master-scheduler" class="tab-content"><div id="master-scheduler-content"></div></div>
            
            <div id="schedule" class="tab-content">
                <div class="card">
                    <div class="flex-between mb-4">
                        <h3>Daily Schedule View</h3>
                        <button onclick="window.validateSchedule?.()" style="background:#f59e0b; color:white; border:none;">âš ï¸ Check Conflicts</button>
                    </div>
                    <div id="scheduleTable"></div>
                </div>
            </div>

            <div id="leagues" class="tab-content"><div id="leaguesContainer"></div></div>
            <div id="specialty-leagues" class="tab-content"><div id="specialtyLeaguesContainer"></div></div>
            <div id="daily-adjustments" class="tab-content"><div id="daily-adjustments-content"></div></div>
            <div id="report" class="tab-content"><div id="report-content"></div></div>
            <div id="print" class="tab-content"><div id="print-content"></div></div>
            <div id="updates" class="tab-content"><div id="updates-content"></div></div>
            <div id="helper" class="tab-content"><div id="helper-content"></div></div>
        </main> 
    </div>

    <!-- Scripts (Order Maintained) -->
    <script src="welcome.js" defer></script>
    <script src="calendar.js" defer></script>
    <script src="app1.js" defer></script>
    <script src="daily_adjustments.js" defer></script>
    <script src="fields.js" defer></script>
    <script src="special_activities.js" defer></script>
    <script src="leagues.js" defer></script>
    <script src="specialty_leagues.js" defer></script> 
    <script src="master_schedule_builder.js" defer></script>
    <script src="scheduler_logic_core.js" defer></script>
    <script src="scheduler_logic_fillers.js" defer></script>
    <script src="scheduler_ui.js" defer></script>
    <script src="analytics.js" defer></script>
    <script src="validator.js" defer></script>
    <script src="print_center.js" defer></script>
    <script src="helper.js" defer></script>
    <script src="updates.js" defer></script>

    <script>
        function showTab(id) {
            // Update Sidebar active state
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            const activeBtn = Array.from(document.querySelectorAll('.nav-item')).find(b => b.getAttribute('onclick').includes(`'${id}'`));
            if(activeBtn) activeBtn.classList.add('active');

            // Update Tab content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');

            // Update Header Title
            const titleMap = {
                'setup': 'General Setup', 'fields': 'Manage Fields', 'special_activities': 'Special Activities',
                'master-scheduler': 'Master Templates', 'daily-adjustments': 'Daily Schedule Builder',
                'schedule': 'View Schedule', 'leagues': 'Regular Leagues', 'specialty-leagues': 'Specialty Leagues',
                'report': 'Analytics & Reports', 'print': 'Print Center'
            };
            document.getElementById('page-title').innerText = titleMap[id] || 'Camp Scheduler';

            // Trigger Lazy Load Logic
            if (id === 'schedule') window.updateTable?.();
        }
    </script>
</body>
</html>

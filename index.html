<!DOCTYPE html>
<html>
<head>
  <title>Camp Scheduler</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { margin-bottom: 20px; }
    .tab-button { padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; background: #f0f0f0; margin-right: 5px; }
    .tab-button.active { background: #007BFF; color: white; font-weight: bold; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid black; padding: 8px; text-align: center; min-width: 80px; }

    .bunk-button { margin: 2px; padding: 5px 10px; cursor: pointer; border: 1px solid #333; border-radius: 4px; display: inline-block; }
    #unassignedBunks { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Camp Scheduler</h1>

  <div class="tabs">
    <button class="tab-button active" onclick="showTab('setup')">Setup & Configuration</button>
    <button class="tab-button" onclick="showTab('schedule')">Daily Schedule</button>
  </div>

  <!-- Setup Tab -->
  <div id="setup" class="tab-content active">
    <h3>Add Bunks</h3>
    <input id="bunkInput" placeholder="Enter bunk">
    <button id="addBunkBtn">Add Bunk</button>
    <h4>Unassigned Bunks</h4>
    <div id="unassignedBunks"></div>

    <h3>Add Fields/Courts</h3>
    <input id="fieldInput" placeholder="Enter field/court name (e.g., Court #1)">
    <button id="addFieldBtn">Add Field/Court</button>
    <div id="fieldList"></div>

    <h3>Generate Times</h3>
    Start: <input type="text" id="startTime" placeholder="e.g., 11:30 AM">
    End: <input type="text" id="endTime" placeholder="e.g., 5:30 PM">
    Increment:
    <select id="increment">
      <option value="15">15 min</option>
      <option value="30">30 min</option>
      <option value="45">45 min</option>
      <option value="60">60 min</option>
    </select>
    <button onclick="generateTimes()">Generate</button>
  </div>

  <!-- Schedule Tab -->
  <div id="schedule" class="tab-content">
    <table id="scheduleTable" style="display:none;">
      <thead>
        <tr id="timeRow"></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let bunks = [];
    let fields = [];
    let times = [];

    function saveState(){
      localStorage.setItem("bunks", JSON.stringify(bunks));
      localStorage.setItem("fields", JSON.stringify(fields));
      localStorage.setItem("times", JSON.stringify(times));
    }
    function loadState(){
      bunks = JSON.parse(localStorage.getItem("bunks") || "[]");
      fields = JSON.parse(localStorage.getItem("fields") || "[]");
      times = JSON.parse(localStorage.getItem("times") || "[]");
    }

    function showTab(id){
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelector(`.tab-button[onclick="showTab('${id}')"]`).classList.add('active');
      if(id==='schedule') updateTable();
    }

    function addBunk(){
      const input = document.getElementById("bunkInput");
      if(input.value.trim()!==""){
        bunks.push(input.value.trim());
        input.value="";
        updateUnassigned();
        saveState();
      }
    }
    document.getElementById("addBunkBtn").onclick = addBunk;
    document.getElementById("bunkInput").addEventListener("keyup", e => { if (e.key === "Enter") addBunk(); });

    function updateUnassigned(){
      const container = document.getElementById("unassignedBunks");
      container.innerHTML="";
      bunks.forEach(bunk=>{
        const span = document.createElement("span");
        span.textContent = bunk;
        span.className = "bunk-button";
        container.appendChild(span);
      });
    }

    function addField(){
      const input = document.getElementById("fieldInput");
      const fieldName = input.value.trim();
      if(fieldName){
        fields.push({name: fieldName, activities: [], available: true});
        input.value="";
        renderFields();
        saveState();
      }
    }
    document.getElementById("addFieldBtn").onclick = addField;
    document.getElementById("fieldInput").addEventListener("keyup", e => { if (e.key === "Enter") addField(); });

    function renderFields(){
      const container = document.getElementById("fieldList");
      container.innerHTML="";
      fields.forEach(field=>{
        const div = document.createElement("div");
        div.textContent = field.name;
        container.appendChild(div);
      });
    }

    function generateTimes(){
      const startInput = document.getElementById("startTime").value.trim();
      const endInput = document.getElementById("endTime").value.trim();
      const increment = parseInt(document.getElementById("increment").value);

      function parseTime(str){
        const match = str.match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i);
        if(!match) return null;
        let h = parseInt(match[1],10);
        const m = parseInt(match[2],10);
        const ampm = match[3].toUpperCase();
        if(ampm==="PM" && h!==12) h+=12;
        if(ampm==="AM" && h===12) h=0;
        return new Date(0,0,0,h,m);
      }

      const start = parseTime(startInput);
      const end = parseTime(endInput);
      if(!start || !end || start>=end){ alert("Enter valid times like 11:30 AM and 5:30 PM."); return; }

      times=[];
      let current = new Date(start);

      function format(d){
        let h=d.getHours();
        let m=d.getMinutes().toString().padStart(2,"0");
        let ampm=h>=12?"PM":"AM";
        h=h%12||12;
        return `${h}:${m} ${ampm}`;
      }

      while(current<end){
        let next=new Date(current.getTime()+increment*60000);
        if(next>end) next=end;
        times.push(`${format(current)} - ${format(next)}`);
        current=next;
      }
      saveState();

      // Bounce to assign.html
      window.location.href = "assign.html";
    }

    function updateTable(){
      const table = document.getElementById("scheduleTable");
      const assignments = JSON.parse(localStorage.getItem("assignments") || "{}");
      if(times.length===0 || bunks.length===0) { table.style.display="none"; return; }
      table.style.display="table";

      const theadRow = document.getElementById("timeRow");
      theadRow.innerHTML = "<th>Time</th>";
      bunks.forEach(bunk=>{
        const th = document.createElement("th");
        th.textContent = bunk;
        theadRow.appendChild(th);
      });

      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML="";
      times.forEach(time=>{
        const row = document.createElement("tr");
        const tdTime = document.createElement("td");
        tdTime.textContent = time;
        row.appendChild(tdTime);

        bunks.forEach(bunk=>{
          const td = document.createElement("td");
          td.textContent = assignments[time]?.[bunk] || "";
          row.appendChild(td);
        });

        tbody.appendChild(row);
      });
    }

    // Load state on startup
    loadState();
    updateUnassigned();
    renderFields();
    updateTable();

    // If assignments exist, auto-open Daily Schedule tab
    if(localStorage.getItem("assignments")){
      showTab("schedule");
    }
  </script>
</body>
</html>

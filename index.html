<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Camp Scheduler</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>üèïÔ∏è Camp Scheduler</h1>

    <div style="padding: 10px 15px; background: #f4f4f4; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd;">
        <label for="calendar-date-picker" style="font-weight: bold; margin-right: 10px; font-size: 1.1em;">Current Schedule Date:</label>
        <input type="date" id="calendar-date-picker" style="font-size: 1.1em; padding: 5px;">
    </div>

    <div class="tabs">
        <button class="tab-button active" onclick="showTab('setup')">Setup & Configuration</button>
        <button class="tab-button" onclick="showTab('schedule')">Daily Schedule</button>
        <button class="tab-button" onclick="showTab('leagues')">Leagues</button>
        <button class="tab-button" onclick="showTab('specialty-leagues'); window.initSpecialtyLeagues?.();">üèÜ Specialty Leagues</button>
        <button class="tab-button" onclick="showTab('daily-overrides'); window.initDailyOverrides?.();">Daily Overrides</button>
    </div>

    <div id="setup" class="tab-content active">
        <h3>Add Bunks</h3>
        <input id="bunkInput" placeholder="Enter bunk (e.g., Bunk 1)">
        <button id="addBunkBtn">Add Bunk</button>
        <div id="unassignedBunks" class="bunk-container"></div>

        <h3>Add Divisions</h3>
        <input id="divisionInput" placeholder="Enter division name (e.g., 5th Grade)">
        <button id="addDivisionBtn">Add Division</button>
        <label style="margin-left:8px;"><input type="checkbox" id="enableColor" checked> Enable Colors</label>
        <div id="divisionButtons" style="margin-top:8px;"></div>
        
        <h3 style="margin-top: 25px; border-top: 2px solid #007BFF; padding-top: 15px;">
            Division Skeletons
        </h3>
        <p style="font-size: 0.9em; color: #555;">
            Select a division above to build its daily "Skeleton." 
            This replaces the old block system.
        </p>
        <div id="divisionSkeletonEditor" style="margin-top: 10px;">
            <p style="color: #666;">Select a division to set its "Skeleton" and "Shopping List."</p>
        </div>
        <hr style="margin: 20px 0;">
        <button id="generateScheduleBtn" style="background: #28a745; color: white; padding: 12px 20px; font-size: 1.2em; border: none; border-radius: 5px; cursor: pointer;">
            Generate/Update Today's Schedule
        </button>
        <hr style="margin: 20px 0;">

        <h3>Add Fields / Courts</h3>
        <input id="fieldInput" placeholder="Enter field/court name (e.g., Court 1)">
        <button id="addFieldBtn">Add Field/Court</button>
        <div id="fieldList"></div>

        <h3>Add Special Activities</h3>
        <input id="specialInput" placeholder="Enter special activity (e.g., Canteen)">
        <button id="addSpecialBtn">Add Special</button>
        <div id="specialList"></div>

        <hr style="margin: 20px 0;">

        <h3>Clear Schedules</h3>
        <p>Use these buttons to clear saved schedule data.
        Your Setup (bunks, fields, etc.) will NOT be affected.</p>

        <button id="eraseTodayBtn"
            style="background: #db7a00; color: #fff; padding: 8px 12px; border: none; border-radius: 4px;
            cursor: pointer; margin-right: 8px;"
            onclick="if(confirm('Are you sure you want to delete the schedule for today?')) window.eraseCurrentDailyData?.();">
            Delete ONLY This Day's Schedule
        </button>

        <button id="eraseAllSchedulesBtn"
            style="background: #c0392b;
            color: #fff; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer;"
            onclick="if(confirm('Are you sure you want to delete ALL saved schedules for ALL days? Your setup will be kept.')) window.eraseAllDailyData?.();">
            Delete ALL Daily Schedules
        </button>

        <hr style="margin: 20px 0;">

        <h3>Erase All Data</h3>
        <p><strong>‚ö†Ô∏è Warning:</strong> This deletes everything.
        It deletes all schedules AND all of your setup (bunks, divisions, fields, leagues, etc.).</p>

        <button id="eraseAllBtn" style="background:#c0392b;color:#fff;">
            Erase All Camp Data (Reset Application)
        </button>

    </div> 
    
    <div id="schedule" class="tab-content">
        <h3>Daily Schedule</h3>
        <div id="scheduleTable"></div>
    </div>

    <div id="leagues" class="tab-content">
        <h3>Leagues Setup</h3>
        <div id="leaguesContainer"></div>
    </div>

    <div id="specialty-leagues" class="tab-content">
        <h2>üèÜ Specialty Leagues</h2>
        <div id="specialtyLeaguesContainer"></div>
    </div>

    <div id="daily-overrides" class="tab-content">
        <div id="daily-overrides-content">
        </div>
    </div>

    <script>
        function showTab(id) {
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelector(`.tab-button[onclick^="showTab('${id}')"]`)?.classList.add('active');

            if (id === 'schedule') {
                window.updateTable?.();
            } else if (id === 'leagues') {
                window.initLeaguesTab?.();
            } else if (id === 'specialty-leagues') {
                window.initSpecialtyLeagues?.();
            }
        }

        document.addEventListener("DOMContentLoaded", boot);

        function boot() {
            // 1. Init Calendar (loads date, save/load fns, migration)
            if (window.initCalendar) {
                window.initCalendar();
            } else {
                console.error("Fatal: calendar.js init not found.");
            }

            // 2. Init App1 (loads bunks, divisions, fields, PERIODS)
            if (window.initApp1) {
                window.initApp1();
            } else {
                console.error("Fatal: app1.js init not found.");
            }

            // 3. Init Leagues (loads league data, renders tab)
            if (window.initLeagues) {
                window.initLeagues();
            } else {
                console.warn("Leagues.js init not found.");
            }

            // 4. Init Schedule System (loads today's schedule)
            if (window.initScheduleSystem) {
                window.initScheduleSystem();
            } else {
                console.warn("initScheduleSystem not found.");
            }

            // 5. Init Specialty Leagues (loads data, renders tab)
            if (window.initSpecialtyLeagues) {
                window.initSpecialtyLeagues();
            } else {
                console.warn("initSpecialtyLeagues not found.");
            }
            
            // 6. NEW: Hook up Generate Button
            const genBtn = document.getElementById('generateScheduleBtn');
            if (genBtn) {
                genBtn.onclick = () => {
                    console.log("Generating schedule...");
                    if (window.generateScheduleFromSkeletons) { // <-- NEW FUNCTION NAME
                        window.generateScheduleFromSkeletons();
                    } else {
                        console.error("generateScheduleFromSkeletons not found!");
                    }
                };
            } else {
                console.error("Generate Schedule Button not found!");
            }
            
            // 7. REMOVED auto-generation
            // window.assignFieldsToBunks();
        }
    </script>

    <script src="calendar.js" defer></script>
    <script src="daily_overrides.js" defer></script>
    <script src="app1.js" defer></script>
    <script src="leagues.js" defer></script>
    <script src="league_scheduling.js" defer></script>

    <script src="specialty_leagues.js" defer></script> 

    <script src="scheduler_logic_core.js" defer></script>
    <script src="scheduler_logic_fillers.js" defer></script>
    <script src="scheduler_ui.js" defer></script>
</body>
</html>

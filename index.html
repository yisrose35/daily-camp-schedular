<!DOCTYPE html>
<html>
<head>
  <title>Camp Scheduler</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid black; padding: 8px; text-align: center; min-width: 80px; }
    th { color: white; }
    td.editable:hover, th.editable:hover { background-color: #f0f0f0; cursor: text; }

    .bunk-button { margin: 2px; padding: 5px 10px; cursor: pointer; border: 1px solid #333; border-radius: 4px; display: inline-block; }
    .selected { background-color: #90CAF9; }
    #unassignedBunks { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Camp Scheduler</h1>

  <!-- Custom Grades -->
  <h3>Custom Grades</h3>
  <input id="gradeInput" placeholder="Enter grade name">
  <button onclick="addGrade()">Add Grade</button>
  <div id="gradeButtons"></div>

  <!-- Bunk Input -->
  <h3>Add Bunks</h3>
  <input id="bunkInput" placeholder="Enter bunk">
  <button onclick="addBunk()">Add Bunk</button>

  <!-- Time Inputs -->
  <h3>Generate Times</h3>
  Start: <input type="time" id="startTime">
  End: <input type="time" id="endTime">
  Increment:
  <select id="increment">
    <option value="15">15 min</option>
    <option value="30">30 min</option>
    <option value="60">60 min</option>
  </select>
  <button onclick="generateTimes()">Generate</button>

  <!-- Unassigned Bunks -->
  <h4>Unassigned Bunks</h4>
  <div id="unassignedBunks"></div>

  <!-- Schedule Table -->
  <table id="scheduleTable">
    <thead>
      <tr id="gradeRow"></tr>
      <tr id="bunkRow"></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let bunks = [];
    let times = [];
    let grades = {}; // { gradeName: [bunk1,bunk2,...] }
    let gradeColors = ['#FFCDD2','#C8E6C9','#BBDEFB','#FFF9C4','#D1C4E9','#FFECB3','#B2DFDB','#F8BBD0'];
    let selectedGrade = null;
    let availableGrades = [];

    // Add a grade
    function addGrade(){
      const input = document.getElementById('gradeInput');
      if(input.value.trim()==="") return;
      const grade = input.value.trim();
      if(!availableGrades.includes(grade)){
        availableGrades.push(grade);
        grades[grade]=[];
        input.value="";
        setupGradeButtons();
        updateTable();
      }
    }

    function setupGradeButtons(){
      const container = document.getElementById("gradeButtons");
      container.innerHTML="";
      availableGrades.forEach((grade,i)=>{
        const btn = document.createElement("button");
        btn.textContent=grade;
        btn.className="bunk-button";
        btn.style.backgroundColor=gradeColors[i%gradeColors.length];
        btn.onclick=()=>{
          selectedGrade=grade;
          Array.from(container.children).forEach(c=>c.classList.remove("selected"));
          btn.classList.add("selected");
        };
        container.appendChild(btn);
      });
    }

    function addBunk(){
      const input = document.getElementById('bunkInput');
      if(input.value.trim()!==""){
        bunks.push(input.value.trim());
        input.value="";
        updateUnassigned();
        updateTable();
      }
    }

    function updateUnassigned(){
      const container = document.getElementById("unassignedBunks");
      container.innerHTML="";
      const unassigned = bunks.filter(b => !Object.values(grades).flat().includes(b));
      unassigned.forEach(bunk=>{
        const btn = document.createElement("div");
        btn.textContent=bunk;
        btn.className="bunk-button";
        btn.onclick = ()=>{
          if(selectedGrade){
            grades[selectedGrade].push(bunk);
            updateUnassigned();
            updateTable();
          } else {
            alert("Select a grade first!");
          }
        };
        container.appendChild(btn);
      });
    }

    // Generate times in 12-hour format
    function generateTimes(){
      const startInput = document.getElementById("startTime").value;
      const endInput = document.getElementById("endTime").value;
      const increment = parseInt(document.getElementById("increment").value);
      if(!startInput || !endInput){alert("Select valid start and end times"); return;}
      let [startH,startM]=startInput.split(":").map(Number);
      let [endH,endM]=endInput.split(":").map(Number);
      const startDate = new Date(0,0,0,startH,startM);
      const endDate = new Date(0,0,0,endH,endM);
      if(startDate>=endDate){alert("Start must be before end"); return;}
      times=[];
      let current = new Date(startDate.getTime());
      while(current<endDate){
        let next = new Date(current.getTime()+increment*60000);
        if(next>endDate) break;
        const format = d=>{
          let h=d.getHours(), m=d.getMinutes().toString().padStart(2,'0');
          h=h%12||12;
          return `${h}:${m}`;
        };
        times.push(`${format(current)} - ${format(next)}`);
        current=next;
      }
      updateTable();
    }

    function updateTable(){
      const gradeRow=document.getElementById("gradeRow");
      const bunkRow=document.getElementById("bunkRow");
      gradeRow.innerHTML="<th>Time / Grade</th>";
      bunkRow.innerHTML="<th>Time / Bunk</th>";

      // Build merged grade headers
      availableGrades.forEach((grade,i)=>{
        const bunksInGrade = grades[grade] || [];
        if(bunksInGrade.length===0) return;
        const thGrade=document.createElement("th");
        thGrade.textContent=grade;
        thGrade.colSpan=bunksInGrade.length;
        thGrade.style.backgroundColor=gradeColors[i%gradeColors.length];
        gradeRow.appendChild(thGrade);

        bunksInGrade.forEach(bunk=>{
          const thBunk=document.createElement("th");
          thBunk.textContent=bunk;
          thBunk.classList.add("editable");
          thBunk.contentEditable="true";
          thBunk.addEventListener("input", e=>{
            const idx = grades[grade].indexOf(bunk);
            if(idx>=0) grades[grade][idx]=e.target.textContent;
          });
          bunkRow.appendChild(thBunk);
        });
      });

      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML="";
      times.forEach(time=>{
        const row=document.createElement("tr");
        const timeCell=document.createElement("td");
        timeCell.textContent=time;
        timeCell.classList.add("editable");
        timeCell.contentEditable="true";
        row.appendChild(timeCell);

        availableGrades.forEach((grade,i)=>{
          const bunksInGrade = grades[grade] || [];
          bunksInGrade.forEach(()=>{
            const cell=document.createElement("td");
            cell.classList.add("editable");
            cell.contentEditable="true";
            row.appendChild(cell);
          });
        });
        tbody.appendChild(row);
      });
    }

    // Move focus from start to end time automatically
    document.getElementById("startTime").addEventListener("input", ()=>{
      if(document.getElementById("startTime").value.length===5){ // hh:mm
        document.getElementById("endTime").focus();
      }
    });

    // Initialize table headers even before bunks
    function initTable(){
      const gradeRow=document.getElementById("gradeRow");
      const bunkRow=document.getElementById("bunkRow");
      gradeRow.innerHTML="<th>Time / Grade</th>";
      bunkRow.innerHTML="<th>Time / Bunk</th>";
    }

    initTable();
  </script>
</body>
</html>

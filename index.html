<!DOCTYPE html>
<html>
<head>
  <title>Camp Scheduler</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { margin-bottom: 20px; }
    .tab-button { padding: 10px 20px; cursor: pointer; border: 1px solid #ccc; background: #f0f0f0; margin-right: 5px; }
    .tab-button.active { background: #007BFF; color: white; font-weight: bold; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid black; padding: 8px; text-align: center; min-width: 80px; }
    .bunk-button { margin: 2px; padding: 5px 10px; cursor: pointer; border: 1px solid #333; border-radius: 4px; display: inline-block; }
    .selected { outline: 3px solid #90CAF9; }
    #unassignedBunks { margin-top: 10px; }
    .divisionWrapper { display: inline-block; margin-right: 10px; }
    .colorPicker { width: 30px; height: 30px; border: none; cursor: pointer; vertical-align: middle; margin-left: 5px; }
    .fieldWrapper { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 6px; }
    .fieldWrapper h4 { margin: 0 0 5px 0; display: inline-block; margin-right: 10px; }
    .activity-button { margin: 2px; padding: 4px 8px; border: 1px solid #333; border-radius: 3px; cursor: pointer; }
    .activity-button.active { background: #007BFF; color: white; }
  </style>
</head>
<body>
  <h1>Camp Scheduler</h1>
  <div class="tabs">
    <button class="tab-button active" onclick="showTab('setup')">Setup & Configuration</button>
    <button class="tab-button" onclick="showTab('schedule')">Daily Schedule</button>
  </div>

  <!-- Setup Tab -->
  <div id="setup" class="tab-content active">
    <h3>Add Bunks</h3>
    <input id="bunkInput" placeholder="Enter bunk">
    <button id="addBunkBtn">Add Bunk</button>

    <h3>Add Divisions</h3>
    <input id="divisionInput" placeholder="Enter division name">
    <button id="addDivisionBtn">Add Division</button>
    <label><input type="checkbox" id="enableColor" checked> Enable colors</label>
    <div id="divisionButtons"></div>

    <h3>Generate Times</h3>
    Start: <input type="text" id="startTime" placeholder="hh:mm AM/PM">
    End: <input type="text" id="endTime" placeholder="hh:mm AM/PM">
    Increment:
    <select id="increment">
      <option value="15">15 min</option>
      <option value="30">30 min</option>
      <option value="45">45 min</option>
      <option value="60">60 min</option>
    </select>
    <button onclick="generateTimes()">Generate</button>

    <h4>Unassigned Bunks</h4>
    <div id="unassignedBunks"></div>

    <h3>Add Fields/Courts</h3>
    <input id="fieldInput" placeholder="Enter field/court name (e.g., Court #1)">
    <button id="addFieldBtn">Add Field/Court</button>
    <div id="fieldList"></div>
  </div>

  <!-- Schedule Tab -->
  <div id="schedule" class="tab-content">
    <table id="scheduleTable" style="display:none;">
      <thead>
        <tr id="divisionRow"></tr>
        <tr id="bunkRow"></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let bunks = [];
    let divisions = {};
    let availableDivisions = [];
    let selectedDivision = null;
    let times = [];
    let fields = [];
    const defaultColors = ['#4CAF50','#2196F3','#E91E63','#FF9800','#9C27B0','#00BCD4','#FFC107','#F44336'];
    let colorIndex = 0;
    const commonActivities = ["Basketball","Baseball","Hockey","Football","Soccer","Volleyball","Lacrosse"];

    // Switch tabs
    function showTab(id) {
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelector(`.tab-button[onclick="showTab('${id}')"]`).classList.add('active');
      if (id === 'schedule') updateTable();
    }

    // === Add Bunk ===
    function addBunk() {
      const input = document.getElementById("bunkInput");
      if (input.value.trim() !== "") {
        bunks.push(input.value.trim());
        input.value = "";
        updateUnassigned();
        updateTable();
      }
    }
    document.getElementById("addBunkBtn").onclick = addBunk;
    document.getElementById("bunkInput").addEventListener("keyup", e => { if (e.key === "Enter") addBunk(); });

    // === Add Division ===
    function addDivision() {
      const input = document.getElementById("divisionInput");
      if (input.value.trim() === "") return;
      const divName = input.value.trim();
      if (!availableDivisions.includes(divName)) {
        const color = defaultColors[colorIndex % defaultColors.length];
        colorIndex++;
        availableDivisions.push(divName);
        divisions[divName] = { bunks: [], color: color };
        input.value = "";
        setupDivisionButtons();
        updateTable();
      }
    }
    document.getElementById("addDivisionBtn").onclick = addDivision;
    document.getElementById("divisionInput").addEventListener("keyup", e => { if (e.key === "Enter") addDivision(); });

    // === Add Field ===
    function addField() {
      const input = document.getElementById("fieldInput");
      if (input.value.trim() !== "") {
        fields.push({ name: input.value.trim(), activities: [], available: true });
        input.value = "";
        renderFields();
      }
    }
    document.getElementById("addFieldBtn").onclick = addField;
    document.getElementById("fieldInput").addEventListener("keyup", e => { if (e.key === "Enter") addField(); });

    // === Update Unassigned Bunks ===
    function updateUnassigned() {
      const container = document.getElementById("unassignedBunks");
      container.innerHTML = "";
      const assigned = Object.values(divisions).flatMap(d => d.bunks);
      bunks.filter(b => !assigned.includes(b)).forEach(bunk => {
        const span = document.createElement("span");
        span.textContent = bunk;
        span.className = "bunk-button";
        span.onclick = () => {
          if (selectedDivision) {
            divisions[selectedDivision].bunks.push(bunk);
            updateUnassigned();
            updateTable();
          } else {
            alert("Select a division first!");
          }
        };
        container.appendChild(span);
      });
    }

    // === Setup Division Buttons ===
    function setupDivisionButtons() {
      const container = document.getElementById("divisionButtons");
      container.innerHTML = "";
      const colorEnabled = document.getElementById("enableColor").checked;
      availableDivisions.forEach(divName => {
        const divObj = divisions[divName];
        const wrapper = document.createElement("div");
        wrapper.className = "divisionWrapper";

        const span = document.createElement("span");
        span.textContent = divName;
        span.className = "bunk-button";
        span.style.backgroundColor = colorEnabled ? divObj.color : "transparent";
        span.onclick = () => {
          selectedDivision = divName;
          container.querySelectorAll("span").forEach(s => s.classList.remove("selected"));
          span.classList.add("selected");
        };
        wrapper.appendChild(span);

        const colorInput = document.createElement("input");
        colorInput.type = "color";
        colorInput.value = divObj.color;
        colorInput.className = "colorPicker";
        colorInput.addEventListener("input", e => {
          divObj.color = e.target.value;
          if (colorEnabled) span.style.backgroundColor = e.target.value;
          updateTable();
        });
        wrapper.appendChild(colorInput);

        container.appendChild(wrapper);
      });
    }

    // === Time handling ===
    function generateTimes() {
      const start = document.getElementById("startTime").value.trim();
      const end = document.getElementById("endTime").value.trim();
      const increment = parseInt(document.getElementById("increment").value);
      if (!start || !end) return alert("Enter valid times with AM/PM");

      function parse(t) {
        const m = t.match(/^(\d{1,2}):(\d{2})\s?(AM|PM)$/i);
        if (!m) return null;
        let h = parseInt(m[1]), min = parseInt(m[2]);
        if (m[3].toUpperCase() === "PM" && h !== 12) h += 12;
        if (m[3].toUpperCase() === "AM" && h === 12) h = 0;
        return new Date(0,0,0,h,min);
      }
      const sDate = parse(start), eDate = parse(end);
      if (!sDate || !eDate || sDate >= eDate) return alert("Invalid times");

      times = [];
      let cur = new Date(sDate);
      while (cur < eDate) {
        let nxt = new Date(cur.getTime() + increment * 60000);
        if (nxt > eDate) nxt = eDate;
        times.push(`${formatTime(cur)} - ${formatTime(nxt)}`);
        cur = nxt;
      }
      updateTable();
    }

    function formatTime(d) {
      let h = d.getHours(), m = d.getMinutes().toString().padStart(2,"0");
      let ampm = h >= 12 ? "PM" : "AM";
      h = h % 12 || 12;
      return `${h}:${m} ${ampm}`;
    }

    // === Render Fields ===
    function renderFields() {
      const container = document.getElementById("fieldList");
      container.innerHTML = "";
      fields.forEach((f, index) => {
        const wrap = document.createElement("div");
        wrap.className = "fieldWrapper";

        const title = document.createElement("h4");
        title.textContent = f.name;
        wrap.appendChild(title);

        commonActivities.forEach(act => {
          const btn = document.createElement("button");
          btn.textContent = act;
          btn.className = "activity-button";
          if (f.activities.includes(act)) btn.classList.add("active");
          btn.onclick = () => {
            if (f.activities.includes(act)) {
              f.activities = f.activities.filter(a => a !== act);
            } else {
              f.activities.push(act);
            }
            renderFields();
          };
          wrap.appendChild(btn);
        });

        const otherInput = document.createElement("input");
        otherInput.placeholder = "Other activity";
        otherInput.onkeyup = e => {
          if (e.key === "Enter" && otherInput.value.trim()) {
            const val = otherInput.value.trim();
            if (!f.activities.includes(val)) f.activities.push(val);
            otherInput.value = "";
            renderFields();
          }
        };
        wrap.appendChild(otherInput);

        if (f.activities.length > 0) {
          const chosen = document.createElement("p");
          chosen.textContent = "Activities: " + f.activities.join(", ");
          wrap.appendChild(chosen);
        }

        container.appendChild(wrap);
      });
    }

    // === Update Schedule Table ===
    function updateTable() {
      const table = document.getElementById("scheduleTable");
      if (times.length === 0) return;
      table.style.display = "table";
      const divRow = document.getElementById("divisionRow");
      const bunkRow = document.getElementById("bunkRow");
      divRow.innerHTML = "<th>Division</th>";
      bunkRow.innerHTML = "<th>Bunk</th>";

      availableDivisions.forEach(divName => {
        const divObj = divisions[divName];
        const th = document.createElement("th");
        th.colSpan = Math.max(divObj.bunks.length, 1);
        th.textContent = divName;
        th.style.backgroundColor = divObj.color;
        th.style.color = "#fff";
        divRow.appendChild(th);
        if (divObj.bunks.length === 0) {
          bunkRow.appendChild(document.createElement("th"));
        } else {
          divObj.bunks.forEach(bunk => {
            const thB = document.createElement("th");
            thB.textContent = bunk;
            bunkRow.appendChild(thB);
          });
        }
      });

      const tbody = document.querySelector("#scheduleTable tbody");
      tbody.innerHTML = "";
      times.forEach(t => {
        const tr = document.createElement("tr");
        const tdTime = document.createElement("td");
        tdTime.textContent = t;
        tr.appendChild(tdTime);
        availableDivisions.forEach(divName => {
          divisions[divName].bunks.forEach(() => {
            tr.appendChild(document.createElement("td"));
          });
        });
        tbody.appendChild(tr);
      });
    }

    // === StartTime Enter → Move to EndTime ===
    document.getElementById("startTime").addEventListener("keyup", e => {
      if (e.key === "Enter" && document.getElementById("startTime").value.match(/(AM|PM)$/i)) {
        document.getElementById("endTime").focus();
      }
    });
  </script>
</body>
</html>
